# In a real-world application, this would be more sophisticated,
# perhaps using a library like `babel`. For this task, a simple
# dictionary-based approach is sufficient.

MESSAGES = {
    "en": {
        "registration_disabled": "User registration is disabled",
        "username_exists": "Username already registered",
        "incorrect_credentials": "Incorrect username or password",
        "login_successful": "Login successful",
        "logout_successful": "Logout successful",
        "incorrect_password": "Current password is incorrect",
        "password_changed": "Password changed successfully",
        # Chat API messages
        "chat.serviceUnavailable": "AI chat service is not available. Please try again later.",
        "chat.agentError": "AI Agent Error",
        "chat.agentErrorMessage": "AI agent error: {error}",
        "chat.agentResponseError": "Empty Agent Response",
        "chat.agentResponseErrorMessage": "Failed to get a valid response from the AI agent. Please try again.",
        "chat.agentResponseEmptyMessage": "Received an empty response from the AI agent. Please try again.",
        "chat.processingError": "Chat Processing Error",
        "chat.processingErrorMessage": "An error occurred while processing your message. Please try again.",
        "chat.serviceNotFound": "Service Not Found",
        "chat.serviceNotFoundMessage": "The AI service is not available. Error: {error}",
        "chat.rateLimitExceeded": "Rate Limit Exceeded",
        "chat.rateLimitExceededMessage": "Too many requests. Error: {error}",
        "chat.connectionError": "Connection Error",
        "chat.connectionErrorMessage": "Unable to connect to AI service. Error: {error}",
        "chat.authError": "Authentication Error",
        "chat.authErrorMessage": "AI service authentication failed. Error: {error}",
        "chat.generalErrorMessage": "An error occurred: {error}",
        "chat.refineFailed": "Failed to refine questions: {error}",
        "chat.approveFailed": "Failed to approve questions: {error}",
        "chat.approveSuccess": "Research questions approved. Research execution has started in the background...",
        "chat.approveStartFailed": "Failed to start research process.",
        # Documents API messages
        "documents.notFoundOrCouldNotAdd": "Document not found or could not be added to group",
        "documents.addedToGroupSuccess": "Document added to group successfully",
        "documents.unsupportedFileType": "Only PDF, Word (docx, doc), and Markdown (md, markdown) files are supported",
        "documents.alreadyUploaded": "This document has already been uploaded: {filename}",
        "documents.uploadStarted": "Document uploaded and processing started",
        "documents.uploadFailed": "Failed to upload document: {error}",
        "documents.alreadyInGroup": "Document '{filename}' already exists in this group",
        "documents.existingAddedToGroup": "Existing document '{filename}' was added to the group",
        "documents.getFilterOptionsFailed": "Failed to get filter options: {error}",
        "documents.groupNotFound": "Document group not found",
        "documents.groupOrDocumentNotFound": "Document group or document not found",
        "documents.groupOrDocumentNotFoundOrNotInGroup": "Document group or document not found, or document not in group",
        "documents.documentNotFound": "Document not found",
        "documents.documentNotFoundInAnyStorage": "Document not found in any storage system",
        "documents.deleteFailed": "Failed to delete document",
        "documents.bulkDeleteFailed": "Deleted {count} documents. Failed to delete: {failed_ids}",
        "documents.bulkAddedToGroup": "Added {count} documents to group",
        "documents.bulkRemovedFromGroup": "Removed {count} documents from group",
        "documents.updateMetadataFailed": "Failed to update document metadata",
        "documents.contentProcessingOrUnavailable": "Document content is being processed or not available.",
        "documents.retrieveContentFailed": "Failed to retrieve document content",
        "documents.cannotCancel": "Document not found or cannot be cancelled",
        "documents.cancelSuccess": "Document processing cancelled successfully",
        "documents.cancelFailed": "Failed to cancel document processing",
        "documents.cancelledByUser": "Cancelled by user",
        # Missions API messages
        "missions.sourceWeb": "Web Source",
        "missions.sourceUnknownDocument": "Unknown Document",
        "missions.sourceInternal": "Internal Analysis",
        "missions.aiComponentsNotInitialized": "AI research components not initialized",
        "missions.requestAndChatIdRequired": "Request and chat_id are required.",
        "missions.atLeastOneSourceEnabled": "At least one information source must be enabled.",
        "missions.failedToCreateMission": "Failed to create mission",
        "missions.missionNotFound": "Mission not found",
        "missions.failedToGetMissionStatus": "Failed to get mission status",
        "missions.failedToGetMissionStats": "Failed to get mission stats",
        "missions.failedToGetMissionPlan": "Failed to get mission plan",
        "missions.failedToGetMissionNotes": "Failed to get mission notes",
        "missions.failedToGetMissionLogs": "Failed to get mission logs",
        "missions.failedToGetMissionDraft": "Failed to get mission draft",
        "missions.failedToGetMissionReport": "Failed to get mission report",
        "missions.cannotResume": "Mission cannot be resumed. Current status: {status}",
        "missions.resumeSuccess": "Mission execution resumed",
        "missions.resumeFailed": "Failed to resume mission execution",
        "missions.stopSuccess": "Mission execution stopped",
        "missions.stopFailed": "Failed to stop mission execution",
        "missions.cannotStart": "Mission cannot be started. Current status: {status}",
        "missions.startSuccess": "Mission execution started",
        "missions.startFailed": "Failed to start mission execution",
        "missions.failedToGetMissionContext": "Failed to get mission context data",
        "missions.failedToGetMissionSettings": "Failed to get mission settings",
        "missions.failedToUpdateMissionSettings": "Failed to update mission settings",
        "missions.failedToConvertToDocx": "Failed to convert report to DOCX: {error}",
        # Admin API messages
        "admin.notFound": "Not found",
        "admin.usernameExists": "Username already registered",
        "admin.userNotFound": "User not found",
        "admin.instanceName": "MAESTRO Instance",
        # Chats API messages
        "chats.createFailed": "Failed to create chat: {error}",
        "chats.getChatsFailed": "Failed to get chats: {error}",
        "chats.chatNotFound": "Chat not found",
        "chats.getChatFailed": "Failed to get chat: {error}",
        "chats.noUpdateData": "No update data provided",
        "chats.updateFailed": "Failed to update chat: {error}",
        "chats.deleteSuccess": "Chat deleted successfully",
        "chats.deleteFailed": "Failed to delete chat: {error}",
        "chats.addMessageFailed": "Failed to add message: {error}",
        "chats.getMessagesFailed": "Failed to get messages: {error}",
        "chats.getMissionsFailed": "Failed to get missions: {error}",
        "chats.getActiveMissionsFailed": "Failed to get active missions: {error}",
        "chats.clearMessagesFailed": "Failed to clear chat messages",
        "chats.clearMessagesSuccess": "Chat messages cleared successfully",
        "chats.clearMessagesError": "Failed to clear messages: {error}",
        "chats.messagePairNotFound": "Message pair not found",
        "chats.deleteMessagePairSuccess": "Deleted {count} messages in the conversation pair",
        "chats.deleteMessagePairFailed": "Failed to delete message pair: {error}",
        "chats.deleteMessagesFromPointSuccess": "Deleted {count} messages from specified point onwards",
        "chats.deleteMessagesFromPointFailed": "Failed to delete messages from point: {error}",
        # Dashboard API messages
        "dashboard.getStatsFailed": "Failed to retrieve dashboard statistics",
        # Settings API messages
        "settings.updateFailed": "Failed to update user settings",
        "settings.updateAppearanceFailed": "Failed to update appearance settings",
        "settings.updateProfileFailed": "Failed to update user profile",
        "settings.baseUrlRequired": "Base URL is required",
        "settings.baseUrlFormat": "Base URL must start with 'http://' or 'https://'",
        "settings.apiKeyRequired": "API key is required for this provider",
        "settings.connectionSuccess": "Connection successful",
        "settings.connectionFailed": "Connection failed: {error}",
        "settings.connectionTestFailed": "Connection test failed: {error}",
        "settings.noApiKey": "No API key configured for provider: {provider}",
        "settings.fetchModelsFailed": "Failed to fetch models: {error}",
        # System API messages
        "system.healthy": "healthy",
        "system.unavailable": "unavailable",
        "system.unhealthy": "unhealthy",
        "system.degraded": "degraded",
        "system.error": "error",
        "system.unknown": "unknown",
        "system.failedToCheckComponents": "Failed to check components",
        "system.adminOnly": "Only admins can run consistency checks",
        "system.consistencyCheckCompleted": "Consistency check completed",
        "system.docNotFoundOrAccessDenied": "Document not found or access denied",
        "system.accessDenied": "Access denied",
        # Utils messages
        "utils.searchDocumentsFor": "Search documents for: \"{query}\"",
        "utils.searchWebFor": "Search web for: \"{query}\"",
        "utils.readDocument": "Read document: {doc_id}",
        "utils.execute": "Execute {tool_name}",
        # WebSockets messages
        "websockets.authRequired": "Authentication required",
        "websockets.invalidToken": "Invalid token",
        "websockets.tokenVerificationError": "Token verification error",
        "websockets.userMismatch": "User not found or mismatch",
        "websockets.userNotFound": "User not found",
        "websockets.connectedToDocUpdates": "Connected to document updates",
        "websockets.missingAuthToken": "Missing authentication token",
        "websockets.connectedToResearchUpdates": "Connected to research updates",
        "websockets.directTestForMission": "Direct test for mission {mission_id}",
        "websockets.internalError": "Internal error",
        "websockets.writingSessionNotFound": "Writing session not found or access denied",
        "websockets.connectedToWritingSession": "Connected to writing session {session_id}",
        # Writing API messages
        "writing.untitledSession": "Untitled Session",
        "writing.createChatFailed": "Failed to create writing chat: {error}",
        "writing.chatNotFound": "Writing chat not found or access denied",
        "writing.docGroupNotFound": "Document group not found or access denied",
        "writing.sessionExists": "Writing session already exists for this chat",
        "writing.writingSessionNotFound": "Writing session not found or access denied",
        "writing.updateStatsFailed": "Failed to update writing session stats",
        "writing.clearStatsFailed": "Failed to clear writing session stats",
        "writing.untitledDocument": "Untitled Document",
        "writing.noCurrentDraft": "No current draft found",
        "writing.currentDraftNotFound": "Current draft not found",
        "writing.deleteSuccess": "Writing session deleted successfully",
        "writing.noSessionForChat": "No writing session found for this chat",
        "writing.draftNotFound": "Draft not found or access denied",
        "writing.requestProcessing": "Your request is being processed. Updates will be streamed via WebSocket.",
        "writing.sessionDataNotFound": "Error: Session data not found.",
        "writing.failedToGenerateDocx": "Failed to generate Word document: {error}",
    },
    "pt": {
        "registration_disabled": "O registro de usuários está desabilitado",
        "username_exists": "Nome de usuário já registrado",
        "incorrect_credentials": "Nome de usuário ou senha incorretos",
        "login_successful": "Login bem-sucedido",
        "logout_successful": "Logout bem-sucedido",
        "incorrect_password": "A senha atual está incorreta",
        "password_changed": "Senha alterada com sucesso",
        # Chat API messages (Portuguese)
        "chat.serviceUnavailable": "O serviço de chat com IA não está disponível. Por favor, tente novamente mais tarde.",
        "chat.agentError": "Erro no Agente de IA",
        "chat.agentErrorMessage": "Erro no agente de IA: {error}",
        "chat.agentResponseError": "Resposta Vazia do Agente",
        "chat.agentResponseErrorMessage": "Falha ao obter uma resposta válida do agente de IA. Por favor, tente novamente.",
        "chat.agentResponseEmptyMessage": "Recebida uma resposta vazia do agente de IA. Por favor, tente novamente.",
        "chat.processingError": "Erro no Processamento do Chat",
        "chat.processingErrorMessage": "Ocorreu um erro ao processar sua mensagem. Por favor, tente novamente.",
        "chat.serviceNotFound": "Serviço Não Encontrado",
        "chat.serviceNotFoundMessage": "O serviço de IA não está disponível. Erro: {error}",
        "chat.rateLimitExceeded": "Limite de Requisições Excedido",
        "chat.rateLimitExceededMessage": "Muitas requisições. Erro: {error}",
        "chat.connectionError": "Erro de Conexão",
        "chat.connectionErrorMessage": "Não foi possível conectar ao serviço de IA. Erro: {error}",
        "chat.authError": "Erro de Autenticação",
        "chat.authErrorMessage": "Falha na autenticação do serviço de IA. Erro: {error}",
        "chat.generalErrorMessage": "Ocorreu um erro: {error}",
        "chat.refineFailed": "Falha ao refinar as perguntas: {error}",
        "chat.approveFailed": "Falha ao aprovar as perguntas: {error}",
        "chat.approveSuccess": "Perguntas de pesquisa aprovadas. A execução da pesquisa começou em segundo plano...",
        "chat.approveStartFailed": "Falha ao iniciar o processo de pesquisa.",
        # Documents API messages (Portuguese)
        "documents.notFoundOrCouldNotAdd": "Documento não encontrado ou não pôde ser adicionado ao grupo",
        "documents.addedToGroupSuccess": "Documento adicionado ao grupo com sucesso",
        "documents.unsupportedFileType": "Apenas arquivos PDF, Word (docx, doc) e Markdown (md, markdown) são suportados",
        "documents.alreadyUploaded": "Este documento já foi enviado: {filename}",
        "documents.uploadStarted": "Documento enviado e processamento iniciado",
        "documents.uploadFailed": "Falha ao enviar documento: {error}",
        "documents.alreadyInGroup": "O documento '{filename}' já existe neste grupo",
        "documents.existingAddedToGroup": "O documento existente '{filename}' foi adicionado ao grupo",
        "documents.getFilterOptionsFailed": "Falha ao obter opções de filtro: {error}",
        "documents.groupNotFound": "Grupo de documentos não encontrado",
        "documents.groupOrDocumentNotFound": "Grupo de documentos ou documento não encontrado",
        "documents.groupOrDocumentNotFoundOrNotInGroup": "Grupo de documentos ou documento não encontrado, ou o documento não está no grupo",
        "documents.documentNotFound": "Documento não encontrado",
        "documents.documentNotFoundInAnyStorage": "Documento não encontrado em nenhum sistema de armazenamento",
        "documents.deleteFailed": "Falha ao deletar o documento",
        "documents.bulkDeleteFailed": "Foram deletados {count} documentos. Falha ao deletar: {failed_ids}",
        "documents.bulkAddedToGroup": "{count} documentos foram adicionados ao grupo",
        "documents.bulkRemovedFromGroup": "{count} documentos foram removidos do grupo",
        "documents.updateMetadataFailed": "Falha ao atualizar os metadados do documento",
        "documents.contentProcessingOrUnavailable": "O conteúdo do documento está sendo processado ou não está disponível.",
        "documents.retrieveContentFailed": "Falha ao recuperar o conteúdo do documento",
        "documents.cannotCancel": "Documento não encontrado ou não pode ser cancelado",
        "documents.cancelSuccess": "Processamento do documento cancelado com sucesso",
        "documents.cancelFailed": "Falha ao cancelar o processamento do documento",
        "documents.cancelledByUser": "Cancelado pelo usuário",
        # Missions API messages (Portuguese)
        "missions.sourceWeb": "Fonte da Web",
        "missions.sourceUnknownDocument": "Documento Desconhecido",
        "missions.sourceInternal": "Análise Interna",
        "missions.aiComponentsNotInitialized": "Componentes de pesquisa de IA não inicializados",
        "missions.requestAndChatIdRequired": "Requisição e chat_id são obrigatórios.",
        "missions.atLeastOneSourceEnabled": "Pelo menos uma fonte de informação deve ser habilitada.",
        "missions.failedToCreateMission": "Falha ao criar missão",
        "missions.missionNotFound": "Missão não encontrada",
        "missions.failedToGetMissionStatus": "Falha ao obter o status da missão",
        "missions.failedToGetMissionStats": "Falha ao obter as estatísticas da missão",
        "missions.failedToGetMissionPlan": "Falha ao obter o plano da missão",
        "missions.failedToGetMissionNotes": "Falha ao obter as notas da missão",
        "missions.failedToGetMissionLogs": "Falha ao obter os logs da missão",
        "missions.failedToGetMissionDraft": "Falha ao obter o rascunho da missão",
        "missions.failedToGetMissionReport": "Falha ao obter o relatório da missão",
        "missions.cannotResume": "A missão não pode ser retomada. Status atual: {status}",
        "missions.resumeSuccess": "Execução da missão retomada",
        "missions.resumeFailed": "Falha ao retomar a execução da missão",
        "missions.stopSuccess": "Execução da missão interrompida",
        "missions.stopFailed": "Falha ao interromper a execução da missão",
        "missions.cannotStart": "A missão não pode ser iniciada. Status atual: {status}",
        "missions.startSuccess": "Execução da missão iniciada",
        "missions.startFailed": "Falha ao iniciar a execução da missão",
        "missions.failedToGetMissionContext": "Falha ao obter os dados de contexto da missão",
        "missions.failedToGetMissionSettings": "Falha ao obter as configurações da missão",
        "missions.failedToUpdateMissionSettings": "Falha ao atualizar as configurações da missão",
        "missions.failedToConvertToDocx": "Falha ao converter o relatório para DOCX: {error}",
        # Admin API messages (Portuguese)
        "admin.notFound": "Não encontrado",
        "admin.usernameExists": "Nome de usuário já registrado",
        "admin.userNotFound": "Usuário não encontrado",
        "admin.instanceName": "Instância MAESTRO",
        # Chats API messages (Portuguese)
        "chats.createFailed": "Falha ao criar chat: {error}",
        "chats.getChatsFailed": "Falha ao obter chats: {error}",
        "chats.chatNotFound": "Chat não encontrado",
        "chats.getChatFailed": "Falha ao obter chat: {error}",
        "chats.noUpdateData": "Nenhum dado de atualização fornecido",
        "chats.updateFailed": "Falha ao atualizar chat: {error}",
        "chats.deleteSuccess": "Chat deletado com sucesso",
        "chats.deleteFailed": "Falha ao deletar chat: {error}",
        "chats.addMessageFailed": "Falha ao adicionar mensagem: {error}",
        "chats.getMessagesFailed": "Falha ao obter mensagens: {error}",
        "chats.getMissionsFailed": "Falha ao obter missões: {error}",
        "chats.getActiveMissionsFailed": "Falha ao obter missões ativas: {error}",
        "chats.clearMessagesFailed": "Falha ao limpar mensagens do chat",
        "chats.clearMessagesSuccess": "Mensagens do chat limpas com sucesso",
        "chats.clearMessagesError": "Falha ao limpar mensagens: {error}",
        "chats.messagePairNotFound": "Par de mensagens não encontrado",
        "chats.deleteMessagePairSuccess": "{count} mensagens deletadas no par de conversas",
        "chats.deleteMessagePairFailed": "Falha ao deletar par de mensagens: {error}",
        "chats.deleteMessagesFromPointSuccess": "{count} mensagens deletadas a partir do ponto especificado",
        "chats.deleteMessagesFromPointFailed": "Falha ao deletar mensagens a partir do ponto: {error}",
        # Dashboard API messages (Portuguese)
        "dashboard.getStatsFailed": "Falha ao recuperar as estatísticas do painel",
        # Settings API messages (Portuguese)
        "settings.updateFailed": "Falha ao atualizar as configurações do usuário",
        "settings.updateAppearanceFailed": "Falha ao atualizar as configurações de aparência",
        "settings.updateProfileFailed": "Falha ao atualizar o perfil do usuário",
        "settings.baseUrlRequired": "A URL base é obrigatória",
        "settings.baseUrlFormat": "A URL base deve começar com 'http://' ou 'https://'",
        "settings.apiKeyRequired": "A chave de API é obrigatória para este provedor",
        "settings.connectionSuccess": "Conexão bem-sucedida",
        "settings.connectionFailed": "Falha na conexão: {error}",
        "settings.connectionTestFailed": "Falha no teste de conexão: {error}",
        "settings.noApiKey": "Nenhuma chave de API configurada para o provedor: {provider}",
        "settings.fetchModelsFailed": "Falha ao buscar modelos: {error}",
        # System API messages (Portuguese)
        "system.healthy": "saudável",
        "system.unavailable": "indisponível",
        "system.unhealthy": "não saudável",
        "system.degraded": "degradado",
        "system.error": "erro",
        "system.unknown": "desconhecido",
        "system.failedToCheckComponents": "Falha ao verificar os componentes",
        "system.adminOnly": "Apenas administradores podem executar verificações de consistência",
        "system.consistencyCheckCompleted": "Verificação de consistência concluída",
        "system.docNotFoundOrAccessDenied": "Documento não encontrado ou acesso negado",
        "system.accessDenied": "Acesso negado",
        # Utils messages (Portuguese)
        "utils.searchDocumentsFor": "Pesquisar documentos por: \"{query}\"",
        "utils.searchWebFor": "Pesquisar na web por: \"{query}\"",
        "utils.readDocument": "Ler documento: {doc_id}",
        "utils.execute": "Executar {tool_name}",
        # WebSockets messages (Portuguese)
        "websockets.authRequired": "Autenticação necessária",
        "websockets.invalidToken": "Token inválido",
        "websockets.tokenVerificationError": "Erro na verificação do token",
        "websockets.userMismatch": "Usuário não encontrado ou incompatível",
        "websockets.userNotFound": "Usuário não encontrado",
        "websockets.connectedToDocUpdates": "Conectado às atualizações de documentos",
        "websockets.missingAuthToken": "Token de autenticação ausente",
        "websockets.connectedToResearchUpdates": "Conectado às atualizações de pesquisa",
        "websockets.directTestForMission": "Teste direto para a missão {mission_id}",
        "websockets.internalError": "Erro interno",
        "websockets.writingSessionNotFound": "Sessão de escrita não encontrada ou acesso negado",
        "websockets.connectedToWritingSession": "Conectado à sessão de escrita {session_id}",
        # Writing API messages (Portuguese)
        "writing.untitledSession": "Sessão sem título",
        "writing.createChatFailed": "Falha ao criar chat de escrita: {error}",
        "writing.chatNotFound": "Chat de escrita não encontrado ou acesso negado",
        "writing.docGroupNotFound": "Grupo de documentos não encontrado ou acesso negado",
        "writing.sessionExists": "Já existe uma sessão de escrita para este chat",
        "writing.writingSessionNotFound": "Sessão de escrita não encontrada ou acesso negado",
        "writing.updateStatsFailed": "Falha ao atualizar as estatísticas da sessão de escrita",
        "writing.clearStatsFailed": "Falha ao limpar as estatísticas da sessão de escrita",
        "writing.untitledDocument": "Documento sem título",
        "writing.noCurrentDraft": "Nenhum rascunho atual encontrado",
        "writing.currentDraftNotFound": "Rascunho atual não encontrado",
        "writing.deleteSuccess": "Sessão de escrita deletada com sucesso",
        "writing.noSessionForChat": "Nenhuma sessão de escrita encontrada para este chat",
        "writing.draftNotFound": "Rascunho não encontrado ou acesso negado",
        "writing.requestProcessing": "Sua solicitação está sendo processada. As atualizações serão transmitidas via WebSocket.",
        "writing.sessionDataNotFound": "Erro: Dados da sessão não encontrados.",
        "writing.failedToGenerateDocx": "Falha ao gerar documento Word: {error}",
    }
}

def get_message(key: str, lang: str = "pt", **kwargs) -> str:
    """
    Retrieves a translated message for a given key and language,
    and formats it with the given keyword arguments.
    Defaults to English if the key is not found in the specified language.
    """
    message_template = MESSAGES.get(lang, MESSAGES["en"]).get(key, MESSAGES["en"].get(key, key))
    try:
        return message_template.format(**kwargs)
    except KeyError:
        # If formatting fails (e.g., placeholder exists but no kwarg provided), return the template
        return message_template
